---
title: "Bank Account Survival Analysis"
date: "2022-09-01"
draft: true
---

Ever wondered how long your bank account will last?
Your bank wants to know that too.

```{r}
library(survival)

# Set seed for reproducibility
set.seed(123)

# Create fake data for customers
customers <- data.frame(
  customer_id = 1:100,
  birthday = sample(1950:2000, 100, replace = TRUE)
)

# Create fake data for accounts
accounts <- data.frame(
  account_id = 1:500,
  customer_id = sample(1:100, 500, replace = TRUE),
  date = sample(seq(as.Date('2020/01/01'), as.Date('2021/12/31'), by = "day"), 500, replace = TRUE),
  balance = rnorm(500, mean = 2000, sd = 1000)
)

# Calculate average balance for each customer
customer_balances <- aggregate(accounts$balance, by = list(customer_id = accounts$customer_id), FUN = mean)
colnames(customer_balances) <- c("customer_id", "average_balance")

# Define a "death" event based on a minimum balance threshold
min_balance_threshold <- 1000
customer_balances$death_event <- ifelse(customer_balances$average_balance < min_balance_threshold, 1, 0)

# Merge customer data with birth year
customer_data <- merge(customers, customer_balances, by.x = "customer_id", by.y = "customer_id")

# Fit a Kaplan-Meier estimator at the customer level
fit_customer <- survfit(Surv(time = customer_data$average_balance, event = customer_data$death_event) ~ 1)

# Plot the survival curve for customers
plot(fit_customer, xlab = "Time", ylab = "Survival Probability", main = "Survival Curve for Customers")
```
